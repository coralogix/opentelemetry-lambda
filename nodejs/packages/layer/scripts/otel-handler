#!/bin/bash
MJS_FILE="${LAMBDA_TASK_ROOT}/${_HANDLER%.*}.mjs"

# If it's an mjs file, then we enable the hook for node modules loading
if [ -f "${DIR_PATH}" ]; then
    # If the file exists, export NODE_OPTIONS
    export NODE_OPTIONS="${NODE_OPTIONS} --experimental-loader=@opentelemetry/instrumentation/hook.mjs"
fi

export NODE_OPTIONS="${NODE_OPTIONS} --require /opt/wrapper.js"

if [[ $OTEL_RESOURCE_ATTRIBUTES != *"service.name="* ]]; then
  export OTEL_RESOURCE_ATTRIBUTES="service.name=${AWS_LAMBDA_FUNCTION_NAME},${OTEL_RESOURCE_ATTRIBUTES}"
fi

exec "$@"
